<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>

<title>MCQ Book Generator PRO</title>

<!-- fonts -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600&family=Kalam:wght@700&display=swap" rel="stylesheet">

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>

/* ---------- UI ---------- */

body{
  background:#0f172a;
  color:#fff;
  font-family:'Noto Sans Devanagari';
  margin:18px;
}

h2{
  text-align:center;
  font-family:'Kalam';
  color:#ffd54f;
}

textarea,input{
  width:100%;
  padding:7px;
  border-radius:8px;
  border:1px solid #333;
  background:#111;
  color:#fff;
  margin-top:5px;
}

button{
  padding:7px 12px;
  border:none;
  border-radius:8px;
  margin:4px;
  font-weight:bold;
  cursor:pointer;
}

.blue{background:#0b74ff}
.green{background:#10b981}
.orange{background:#f59e0b}
.red{background:#ef4444}

.controls{
  background:#1e293b;
  padding:12px;
  border-radius:10px;
}

/* ---------- BOOK PAGE ---------- */

.page{
  width:794px;
  height:1123px;
  background:#fff;
  color:#000;
  margin:25px auto;
  box-sizing:border-box;

  /* header & footer gap */
  padding:70px 60px 90px 60px;

  display:grid;
  grid-template-columns:1fr 1fr;
  column-gap:40px;
  row-gap:18px;

  font-family:'Noto Sans Devanagari';
}

.header{
  position:absolute;
  top:20px;
  left:0;
  right:0;
  text-align:center;
  font-weight:bold;
}

.footer{
  position:absolute;
  bottom:20px;
  left:0;
  right:0;
  text-align:center;
  font-size:13px;
}

.qbox{
  font-size:14px;
  line-height:1.4;
}

.divider{
  border-top:1.8px solid #000;
  margin:6px 0;
}

.exp{
  border:2px solid #000;
  border-radius:12px;
  padding:5px;
  font-size:13px;
}

.ans{
  font-weight:bold;
  margin-top:3px;
}

/* preview editable */
.qbox[contenteditable]{
  outline:1px dashed #aaa;
}

</style>
</head>

<body>

<h2>MCQ Book Generator</h2>

<div class="controls">

<textarea id="jsonArea" rows="4" placeholder="JSON paste here..."></textarea>

<button class="orange" onclick="importJSON()">Import JSON</button>
<button class="green" onclick="addManual()">Add Manual</button>
<button class="blue" onclick="translateAll()">Translate</button>
<button class="blue" onclick="generatePDF()">Generate PDF</button>
<button class="red" onclick="clearAll()">Clear</button>

<hr>

<input id="q" placeholder="Question (Hindi)">
<input id="o1" placeholder="Option A">
<input id="o2" placeholder="Option B">
<input id="o3" placeholder="Option C">
<input id="o4" placeholder="Option D">
<input id="ans" placeholder="Answer (A/B/C/D)">
<input id="exp" placeholder="Explanation">

</div>

<div id="preview"></div>

<script>

const { jsPDF } = window.jspdf;
let DATA=[];


/* ---------- ADD MANUAL ---------- */

function addManual(){

  DATA.push({
    question:q.value,
    options:[o1.value,o2.value,o3.value,o4.value],
    answer:ans.value,
    exp:exp.value,
    eng:{}
  });

  q.value=o1.value=o2.value=o3.value=o4.value=ans.value=exp.value="";
  render();
}


/* ---------- JSON ---------- */

function importJSON(){
  DATA=JSON.parse(jsonArea.value);
  render();
}


/* ---------- TRANSLATE ---------- */

async function translate(t){
  const r=await fetch(
   `https://translate.googleapis.com/translate_a/single?client=gtx&sl=hi&tl=en&dt=t&q=${encodeURIComponent(t)}`
  );
  const d=await r.json();
  return d[0].map(x=>x[0]).join("");
}

async function translateAll(){

  for(let item of DATA){
    item.eng.question=await translate(item.question);
    item.eng.options=[];
    for(let o of item.options)
      item.eng.options.push(await translate(o));
  }

  render();
  alert("Translated âœ“");
}


/* ---------- PREVIEW (BOOK STYLE) ---------- */

function render(){

  preview.innerHTML="";

  let page=createPage(1);
  preview.appendChild(page);

  let perPage=8;
  let count=0;
  let pageNo=1;

  DATA.forEach((item,i)=>{

    if(count===perPage){
      page=createPage(++pageNo);
      preview.appendChild(page);
      count=0;
    }

    const div=document.createElement("div");
    div.className="qbox";
    div.contentEditable=true;

    div.innerHTML=`
<b>Q${i+1}. ${item.question}</b><br>
A. ${item.options[0]}<br>
B. ${item.options[1]}<br>
C. ${item.options[2]}<br>
D. ${item.options[3]}

<div class="divider"></div>

<div class="exp">Explanation: ${item.exp}</div>
<div class="ans">Answer: ${item.answer}</div>

<br><i>${item.eng?.question || ""}</i>
`;

    page.appendChild(div);
    count++;
  });
}


function createPage(no){

  const p=document.createElement("div");
  p.className="page";

  const head=document.createElement("div");
  head.className="header";
  head.innerText="MCQ Practice Book";

  const foot=document.createElement("div");
  foot.className="footer";
  foot.innerText="Page "+no;

  p.appendChild(head);
  p.appendChild(foot);

  return p;
}


/* ---------- PDF ---------- */

async function generatePDF(){

  const pages=document.querySelectorAll(".page");

  const pdf=new jsPDF('p','px',[794,1123]);

  for(let i=0;i<pages.length;i++){

    const canvas=await html2canvas(pages[i],{scale:2});
    const img=canvas.toDataURL("image/png");

    if(i>0) pdf.addPage();
    pdf.addImage(img,'PNG',0,0,794,1123);
  }

  pdf.save("MCQ_Book.pdf");
}


/* ---------- CLEAR ---------- */

function clearAll(){
  DATA=[];
  preview.innerHTML="";
}

</script>
</body>
</html>
