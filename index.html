<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>

<title>Mockrise MCQ Book</title>

<!-- correct CDN -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">

<style>

/* ---------- UI ---------- */

body{
  background:#0f172a;
  color:#fff;
  font-family:'Noto Sans Devanagari';
  margin:16px;
}

textarea,input{
  width:100%;
  padding:8px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #333;
  background:#111;
  color:#fff;
}

button{
  padding:8px 12px;
  border:none;
  border-radius:8px;
  margin:5px 3px;
  font-weight:bold;
  cursor:pointer;
}

.blue{background:#0b74ff}
.green{background:#10b981}
.orange{background:#f59e0b}
.red{background:#ef4444}

.controls{
  background:#1e293b;
  padding:12px;
  border-radius:10px;
}

/* ---------- BOOK PAGE ---------- */

.page{
  width:794px;
  height:1123px;
  background:#fff;
  color:#000;
  margin:25px auto;

  padding:110px 60px 100px 60px;
  box-sizing:border-box;

  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;

  font-family:'Noto Sans Devanagari';
  position:relative;
}

/* header line */
.header{
  position:absolute;
  top:25px;
  left:40px;
  right:40px;
  border-top:2px solid #000;
  padding-top:6px;
  font-weight:bold;
}

/* footer page number */
.footer{
  position:absolute;
  bottom:25px;
  left:0;
  right:0;
  text-align:center;
  font-size:14px;
}

/* question style */
.qbox{
  font-size:14px;
  line-height:1.45;
  white-space:pre-wrap;
}

.divider{
  border-top:1.5px solid #000;
  margin:6px 0;
}

.exp{
  border:2px solid #000;
  border-radius:10px;
  padding:5px;
}

.ans{
  font-weight:bold;
  margin-top:3px;
}

.qbox[contenteditable]{
  outline:1px dashed #aaa;
}

</style>
</head>

<body>

<h2>Mockrise MCQ Book Generator</h2>

<div class="controls">

<textarea id="jsonArea" rows="4" placeholder="JSON paste here..."></textarea>

<button class="orange" onclick="importJSON()">Import JSON</button>
<button class="green" onclick="addManual()">Add Manual</button>
<button class="blue" onclick="generatePDF()">Generate PDF</button>
<button class="red" onclick="clearAll()">Clear</button>

<hr>

<input id="q" placeholder="Question">
<input id="o1" placeholder="Option A">
<input id="o2" placeholder="Option B">
<input id="o3" placeholder="Option C">
<input id="o4" placeholder="Option D">
<input id="ans" placeholder="Answer (A/B/C/D)">
<input id="exp" placeholder="Explanation">

</div>

<div id="preview"></div>

<script>

const { jsPDF } = window.jspdf;

let DATA=[];


/* -------- ADD MANUAL -------- */

function addManual(){

  DATA.push({
    question:q.value,
    options:[o1.value,o2.value,o3.value,o4.value],
    answer:ans.value,
    exp:exp.value
  });

  q.value=o1.value=o2.value=o3.value=o4.value=ans.value=exp.value="";
  render();
}


/* -------- JSON IMPORT -------- */

function importJSON(){
  try{
    DATA=JSON.parse(jsonArea.value);
    render();
  }catch{
    alert("Invalid JSON");
  }
}


/* -------- PREVIEW RENDER -------- */

function render(){

  preview.innerHTML="";

  let page=createPage(1);
  preview.appendChild(page);

  let perPage=8;
  let count=0;
  let pageNo=1;

  DATA.forEach((item,i)=>{

    if(count===perPage){
      page=createPage(++pageNo);
      preview.appendChild(page);
      count=0;
    }

    const div=document.createElement("div");
    div.className="qbox";
    div.contentEditable=true;

    div.innerHTML=
`<b>Q${i+1}. ${item.question}</b><br>
A. ${item.options[0]}<br>
B. ${item.options[1]}<br>
C. ${item.options[2]}<br>
D. ${item.options[3]}
<div class="divider"></div>
<div class="exp">Explanation: ${item.exp}</div>
<div class="ans">Answer: ${item.answer}</div>`;

    page.appendChild(div);
    count++;
  });
}


/* -------- CREATE PAGE -------- */

function createPage(no){

  const p=document.createElement("div");
  p.className="page";

  const header=document.createElement("div");
  header.className="header";
  header.innerText="Mockrise";

  const footer=document.createElement("div");
  footer.className="footer";
  footer.innerText="Page "+no;

  p.appendChild(header);
  p.appendChild(footer);

  return p;
}


/* -------- PDF -------- */

async function generatePDF(){

  const pages=document.querySelectorAll(".page");

  const pdf=new jsPDF('p','px',[794,1123]);

  for(let i=0;i<pages.length;i++){

    const canvas=await html2canvas(pages[i],{scale:2});
    const img=canvas.toDataURL("image/png");

    if(i>0) pdf.addPage();
    pdf.addImage(img,'PNG',0,0,794,1123);
  }

  pdf.save("Mockrise_Book.pdf");
}


/* -------- CLEAR -------- */

function clearAll(){
  DATA=[];
  preview.innerHTML="";
}

</script>

</body>
</html>
