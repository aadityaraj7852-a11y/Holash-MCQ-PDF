<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8"/>

<title>Mockrise MCQ Book Pro</title>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet">

<style>

/* ---------- UI ---------- */

body{
  background:#0f172a;
  color:#fff;
  font-family:'Noto Sans Devanagari';
  margin:15px;
}

textarea,input{
  width:100%;
  padding:7px;
  border-radius:7px;
  border:1px solid #333;
  background:#111;
  color:#fff;
  margin-top:6px;
}

button{
  padding:7px 12px;
  border:none;
  border-radius:8px;
  margin:5px 3px;
  font-weight:bold;
  cursor:pointer;
}

.blue{background:#0b74ff}
.green{background:#10b981}
.orange{background:#f59e0b}
.red{background:#ef4444}

.controls{
  background:#1e293b;
  padding:12px;
  border-radius:10px;
}

/* ---------- BOOK PAGE ---------- */

.page{
  width:794px;
  height:1123px;
  background:#fff;
  color:#000;
  margin:30px auto;
  padding:100px 60px 90px 60px;
  box-sizing:border-box;
  position:relative;
  font-family:'Noto Sans Devanagari';

  display:flex;
  gap:30px;
}

.column{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* header */
.header{
  position:absolute;
  top:25px;
  left:40px;
  right:40px;
  border-top:2px solid #000;
  padding-top:5px;
  font-weight:bold;
}

/* footer */
.footer{
  position:absolute;
  bottom:20px;
  left:0;
  right:0;
  text-align:center;
  font-size:13px;
}

/* question style */
.qbox{
  font-size:13px;
  line-height:1.35;
  white-space:normal;
}

.qbox b{
  font-size:14px;
}

.option{
  margin-left:10px;
  margin-bottom:2px;
}

.divider{
  border-top:1px solid #000;
  margin:4px 0;
}

.exp{
  border:1.5px solid #000;
  border-radius:8px;
  padding:4px;
  font-size:12px;
}

.ans{
  font-weight:bold;
  font-size:12px;
}

.qbox[contenteditable]{
  outline:1px dashed #aaa;
}

</style>
</head>

<body>

<h2>Mockrise MCQ Book Generator</h2>

<div class="controls">

<textarea id="jsonArea" rows="4" placeholder="JSON paste here"></textarea>

<button class="orange" onclick="importJSON()">Import JSON</button>
<button class="green" onclick="addManual()">Add Manual</button>
<button class="blue" onclick="generatePDF()">Generate PDF</button>
<button class="red" onclick="clearAll()">Clear</button>

<hr>

<input id="q" placeholder="Question">
<input id="o1" placeholder="Option A">
<input id="o2" placeholder="Option B">
<input id="o3" placeholder="Option C">
<input id="o4" placeholder="Option D">
<input id="ans" placeholder="Answer">
<input id="exp" placeholder="Explanation">

</div>

<div id="preview"></div>

<script>

const { jsPDF } = window.jspdf;

let DATA=[];


/* -------- ADD -------- */

function addManual(){
  DATA.push({
    question:q.value,
    options:[o1.value,o2.value,o3.value,o4.value],
    answer:ans.value,
    exp:exp.value
  });

  q.value=o1.value=o2.value=o3.value=o4.value=ans.value=exp.value="";
  render();
}


/* -------- JSON -------- */

function importJSON(){
  DATA=JSON.parse(jsonArea.value);
  render();
}


/* -------- CREATE PAGE -------- */

function createPage(no){

  const page=document.createElement("div");
  page.className="page";

  const header=document.createElement("div");
  header.className="header";
  header.innerText="Mockrise";

  const footer=document.createElement("div");
  footer.className="footer";
  footer.innerText="Page "+no;

  const col1=document.createElement("div");
  col1.className="column";

  const col2=document.createElement("div");
  col2.className="column";

  page.append(header,footer,col1,col2);

  return {page,col1,col2};
}


/* -------- RENDER AUTO FLOW -------- */

function render(){

  preview.innerHTML="";

  let pageNo=1;
  let {page,col1,col2}=createPage(pageNo);
  preview.appendChild(page);

  let currentCol=col1;

  DATA.forEach((item,i)=>{

    const box=createQBox(item,i);

    currentCol.appendChild(box);

    // overflow check
    if(currentCol.scrollHeight > currentCol.clientHeight){

      currentCol.removeChild(box);

      if(currentCol===col1){
        currentCol=col2;
        currentCol.appendChild(box);
      }else{
        ({page,col1,col2}=createPage(++pageNo));
        preview.appendChild(page);
        currentCol=col1;
        currentCol.appendChild(box);
      }
    }
  });
}


/* -------- QBOX -------- */

function createQBox(item,i){

  const div=document.createElement("div");
  div.className="qbox";
  div.contentEditable=true;

  div.innerHTML=
`<b>Q${i+1}. ${item.question}</b>
<div class="option">A. ${item.options[0]}</div>
<div class="option">B. ${item.options[1]}</div>
<div class="option">C. ${item.options[2]}</div>
<div class="option">D. ${item.options[3]}</div>
<div class="divider"></div>
<div class="exp">Explanation: ${item.exp}</div>
<div class="ans">Answer: ${item.answer}</div>`;

  return div;
}


/* -------- PDF -------- */

async function generatePDF(){

  const pages=document.querySelectorAll(".page");
  const pdf=new jsPDF('p','px',[794,1123]);

  for(let i=0;i<pages.length;i++){
    const canvas=await html2canvas(pages[i],{scale:2});
    const img=canvas.toDataURL("image/png");

    if(i>0) pdf.addPage();
    pdf.addImage(img,'PNG',0,0,794,1123);
  }

  pdf.save("Mockrise_Book.pdf");
}


/* -------- CLEAR -------- */

function clearAll(){
  DATA=[];
  preview.innerHTML="";
}

</script>

</body>
</html>
